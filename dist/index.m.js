import e from"axios";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},r.apply(this,arguments)}function t(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,n(e,r)}function n(e,r){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},n(e,r)}var s;function o(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}!function(e){e.PROD="https://api-prod.getmessenger.ng",e.STAGING="https://api-staging.getmessenger.ng"}(s||(s={}));var i=/*#__PURE__*/function(e){function r(r,t,n){return e.call(this,r,t,n)||this}return t(r,e),r}(/*#__PURE__*/function(e){function r(r,t,n){var s;return(s=e.call(this,r,t,n)||this).baseOrderUrl=void 0,s.baseOrderUrl="/orders",s}t(r,e);var n=r.prototype;return n.estimateOrder=function(e){try{return Promise.resolve(this.makeApiRequest({method:"post",url:this.baseOrderUrl+"/estimate",data:e}))}catch(e){return Promise.reject(e)}},n.getAddressCoordinates=function(e){try{return Promise.resolve(this.makeApiRequest({method:"post",url:this.baseOrderUrl+"/get-address-coordinates",data:e}))}catch(e){return Promise.reject(e)}},n.confirmOrder=function(e){try{return Promise.resolve(this.makeApiRequest({method:"post",url:this.baseOrderUrl+"/confirm",data:e}))}catch(e){return Promise.reject(e)}},n.cancelOrder=function(e,r){try{return Promise.resolve(this.makeApiRequest({method:"post",url:this.baseOrderUrl+"/"+r+"/cancel",data:e}))}catch(e){return Promise.reject(e)}},n.disputeOrder=function(e,r){try{return Promise.resolve(this.makeApiRequest({method:"post",url:this.baseOrderUrl+"/"+r+"/dispute",data:e}))}catch(e){return Promise.reject(e)}},n.fetchOrders=function(){try{return Promise.resolve(this.makeApiRequest({method:"get",url:""+this.baseOrderUrl}))}catch(e){return Promise.reject(e)}},n.fetchOrderById=function(e){try{return Promise.resolve(this.makeApiRequest({method:"get",url:this.baseOrderUrl+"/"+e}))}catch(e){return Promise.reject(e)}},n.fetchOrdersAnalytics=function(){try{return Promise.resolve(this.makeApiRequest({method:"get",url:this.baseOrderUrl+"/analytics"}))}catch(e){return Promise.reject(e)}},r}(/*#__PURE__*/function(e){function r(r,t,n){var s;return(s=e.call(this,r,t,n)||this).baseWalletUrl=void 0,s.baseWalletUrl="/wallets",s}t(r,e);var n=r.prototype;return n.checkWalletBalance=function(){try{return Promise.resolve(this.makeApiRequest({method:"get",url:this.baseWalletUrl}))}catch(e){return Promise.reject(e)}},n.getAllTransactions=function(e){try{return Promise.resolve(this.makeApiRequest({method:"get",url:this.baseWalletUrl+"/"+e+"/transactions"}))}catch(e){return Promise.reject(e)}},n.getTransactionByReference=function(e){try{return Promise.resolve(this.makeApiRequest({method:"get",url:this.baseWalletUrl+"/transactions/"+e}))}catch(e){return Promise.reject(e)}},r}(/*#__PURE__*/function(){function t(r,t,n){var o=this;if(this.baseURL=void 0,this.publicKey=void 0,this.privateKey=void 0,this.axiosInstance=void 0,this.environment=s.PROD,this.baseAuthUrl=void 0,this.accessToken=null,this.authenticationData=null,this.baseAuthUrl="/auth",!r||!t)throw new Error("Public or Private keys are required!");this.environment||console.warn("No environment specified. Defaulting to development."),this.environment=n||"development",this.baseURL="test"===this.environment||"development"===this.environment?s.STAGING:s.PROD,this.publicKey=r,this.privateKey=t,this.axiosInstance=e.create({baseURL:this.baseURL,headers:{"Content-Type":"application/json"}}),this.axiosInstance.interceptors.response.use(function(e){return e},function(r){try{return r.response&&401===r.response.status?(o.login(),Promise.resolve(e(r.config))):Promise.reject(r)}catch(e){return Promise.reject(e)}})}var n=t.prototype;return n.login=function(){try{var e=this;if(!e.publicKey||!e.privateKey)throw new Error("Public or Private keys are required!");e.environment||console.warn("No environment specified. Defaulting to development.");var r=Buffer.from(e.publicKey+":"+e.privateKey).toString("base64");return Promise.resolve(o(function(){return Promise.resolve(e.axiosInstance.post(e.baseAuthUrl+"/login",{},{headers:{Authorization:"Basic "+r},auth:{username:e.publicKey,password:e.privateKey}})).then(function(r){return e.accessToken=r.headers["access-token"],r.data})},function(e){var r;return console.warn(null==e||null==(r=e.response)||null==(r=r.data)?void 0:r.message),e.response.data}))}catch(e){return Promise.reject(e)}},n.makeApiRequest=function(t){try{var n=this;return Promise.resolve(o(function(){if(!n.accessToken)throw new Error("Access token is missing or invalid.");return t.headers=r({},t.headers,{Authorization:"Bearer "+n.accessToken}),Promise.resolve(n.axiosInstance(t)).then(function(e){return e.data})},function(r){var s;function o(e){if(s)return e;throw console.error("Unknown error:",r),r}var i=function(){if(e.isAxiosError(r)){var o=function(e){var r;if(s)return e;throw console.error("API request failed:",null==i||null==(r=i.response)?void 0:r.data),i},i=r,a=function(){if(i.response&&401===i.response.status)return console.error("Received 401. Attempting to refresh access token..."),Promise.resolve(n.login()).then(function(){console.log(n.login()),console.log("Access token successfully refreshed. Retrying the request.");var e=n.makeApiRequest(t);return s=1,e})}();return a&&a.then?a.then(o):o(a)}}();return i&&i.then?i.then(o):o(i)}))}catch(e){return Promise.reject(e)}},n.getAccessToken=function(){return this.accessToken?this.accessToken:null},t}())));export{i as default};
